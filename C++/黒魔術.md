# 黒魔術

ここでいう黒魔術は [C++魔術回路構成法](https://qiita.com/_EnumHack/items/92e6e135174f1f781dbb) のような C++ の言語仕様によるものではなく、定数倍高速化などのことを指します



## 高速化

### `bitset`を使う

これは64倍高速化

定数倍にしては大きすぎるので普通に高速化

もし`vector<bool>`とかを使っているならすぐにやめよう



### ベクトル化を信じる

俺の書いたC++は早い！！！って叫びながら $10^9$ ループを提出すれば通る



```cpp
for (int i=0;i<1e9;i++){
  cnt++;
}
```

くらいにループの中身が単調だと最適化がかかってくれる



### 計算量を改善しよう

定数倍高速化をする前に良いアルゴリズムを考えよう



## 定数倍高速化

### 座標圧縮するときに前計算する

座圧後の値を取り出すときに毎回二分探索するよりも、使う値をあらかじめ二分探索しておくことで速さがかなり変わる



### `map`よりも座標圧縮をしよう

`map`は定数倍が重いので、座標圧縮で済む場合は座標圧縮に切り替える



### 除算を控える

mod の計算とかを

```cpp
if (a > mod) a -= mod;
```

とかにする



### コンパイラ最適化を強くする

これは`QCFium`法

```cpp
#pragma GCC target("avx2")
#pragma GCC optimize("O3")
#pragma GCC optimize("unroll-loops")
```



### ループの順番を入れ替える

```cpp
for(int i=0;i<5;i++){
  for(int j=0;j<n;j++){
    // O(1)
  }
}
```

と

```cpp
for(int i=0;i<n;i++){
  for(int j=0;j<5;j++){
    // O(1)
  }
}
```

だと、上の方が早い



### 再帰しない

再帰は`stack`を用いれば書けるので頑張って非再帰にしよう

`stack`で深さ優先探索とかするときは再帰のときと進む順番が違うのでもし問題になるのであれば気を付けよう



### 事前に`reserve`する

`vector` だけでなく `unordered_map` なども

ならし計算量をならしじゃなくできる



### `constexpr` を使う

コンパイル時にバイナリに埋め込んでくれます



### `vector`を使わない

`vector`は遅い！（素振り）



### 配列を毎回宣言しない

あらかじめ作っておいたり、再利用したりしよう



### `emplace_back`を使う

プリミティブ型でないものを`push_back`すると、その都度コピーコンストラクタが呼び出されるので遅い

`pair`や自作のクラスなどが早くなる



### `long long` ではなく `int` を使う

できることなら `short int` にしてみたり

小さければキャッシュにのりやすくなるので



### `inline` 展開をしてみる

はい、犯罪

これで通ったら大犯罪をしています

悔い改めましょう



### `new` や `delete` をしない

あらかじめ作った配列から値を取ってくる方式にする



### 自作 `pair/tuple` を使う

これはうーんという感じ



### 自作 `set` を使う

つくれませ～～～～ん

平衡二分探索木を作る必要があるが、`SplayTree`だとならしなのでやばそう



### 高速な入出力を使う

`cin.tie`や`ios::sync_with_stdio`はもちろん、`scanf/printf`を使うのも考える









## 参考

- [うしさんのツイート](https://twitter.com/ei1333/status/1443898614359609344?s=20)
- [Joeさんのブログ](https://xuzijian629.hatenablog.com/entry/2019/03/31/130708)
- [kaageさんのQiita記事](https://qiita.com/ageprocpp/items/7bda728d109c953ece3c)

